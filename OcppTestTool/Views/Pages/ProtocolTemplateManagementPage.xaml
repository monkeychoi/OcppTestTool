<Page x:Class="OcppTestTool.Views.Pages.ProtocolTemplateManagementPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:local="clr-namespace:OcppTestTool.Views.Pages"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:models="clr-namespace:OcppTestTool.Models"
      xmlns:uc="clr-namespace:OcppTestTool.UserControls"
      xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
      Title="ProtocolManagementPage"
      d:DataContext="{d:DesignInstance local:ProtocolTemplateManagementPage,
                                        IsDesignTimeCreatable=False}"
      d:DesignHeight="450"
      d:DesignWidth="800"
      ui:Design.Background="{DynamicResource ApplicationBackgroundBrush}"
      ui:Design.Foreground="{DynamicResource TextFillColorPrimaryBrush}"
      Foreground="{DynamicResource TextFillColorPrimaryBrush}"
      ScrollViewer.CanContentScroll="False"
      mc:Ignorable="d">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <TextBlock Text="프로토콜 템플릿 관리"
                       FontSize="20"
                       FontWeight="SemiBold"
                       VerticalAlignment="Center" />
            <StackPanel Orientation="Horizontal"
                        HorizontalAlignment="Right"
                        Grid.Column="1"
                        Margin="12,0,0,0">
                <Button Content="새로고침"
                        Command="{Binding ViewModel.RefreshCommand}"
                        IsEnabled="{Binding ViewModel.IsBusy, Converter={StaticResource InverseBool}}" />
                <Button Content="신규 등록"
                        Margin="8,0,0,0"
                        Command="{Binding ViewModel.OpenCreateCommand}"
                        IsEnabled="{Binding ViewModel.IsBusy, Converter={StaticResource InverseBool}}" />
                <Button Content="수정"
                        Margin="8,0,0,0"
                        Command="{Binding ViewModel.OpenEditCommand}"
                        IsEnabled="{Binding ViewModel.SelectedProtocolTemplate, Converter={StaticResource NotNullToBool}}" />
                <Button Content="삭제"
                        Margin="8,0,0,0"
                        Command="{Binding ViewModel.OpenDeleteCommand}"
                        IsEnabled="{Binding ViewModel.SelectedProtocolTemplate, Converter={StaticResource NotNullToBool}}" />
            </StackPanel>
            
        </Grid>

        <StackPanel Orientation="Horizontal"
                    Grid.Row="1"
                    Margin="0,12,0,0">
            <TextBlock Text="프로토콜 선택: "
                       VerticalAlignment="Center" />
            <ComboBox Width="200"
                      IsEditable="True"
                      IsReadOnly="True"
                      ItemsSource="{Binding ViewModel.Protocols}"
                      SelectedItem="{Binding ViewModel.SelectedProtocol, Mode=TwoWay}"
                      DisplayMemberPath="Name"
                      Text="{Binding ViewModel.SelectedProtocol.Name,
                         TargetNullValue='프로토콜 선택',
                         FallbackValue='프로토콜 선택'}"/>

        </StackPanel>

        <ui:DataGrid Grid.Row="2"
                     Margin="0,8,0,0"
                     ItemsSource="{Binding ViewModel.ProtocolTemplates}"
                     SelectedItem="{Binding ViewModel.SelectedProtocolTemplate, Mode=TwoWay}"
                     Style="{StaticResource AppDataGridStyle}">

            <ui:DataGrid.Columns>
                <DataGridTextColumn Binding="{Binding Id}"
                                    Header="ID"
                                    Width="60" />
                <DataGridTextColumn Binding="{Binding SchemaName}"
                                    Header="SchemaName"
                                    Width="230" />
                <DataGridTextColumn Binding="{Binding TemplateName}"
                                    Header="TemplateName"
                                    Width="SizeToCells"
                                    MinWidth="250">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="TextTrimming"
                                    Value="CharacterEllipsis" />
                            <Setter Property="ToolTip"
                                    Value="{Binding TemplateName}" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
                <DataGridTextColumn Binding="{Binding Direction}"
                                    Header="Direction"
                                    Width="120" />
                <DataGridTextColumn Binding="{Binding MessageType}"
                                    Header="MessageType"
                                    Width="200" />
                <DataGridTextColumn Binding="{Binding Version}"
                                    Header="Version"
                                    Width="80" />
                <DataGridTextColumn Header="Created"
                                    Width="170"
                                    Binding="{Binding CreatedAt, Converter={StaticResource UtcToKst}}" />
                <DataGridTextColumn Header="Updated"
                                    Width="170"
                                    Binding="{Binding UpdatedAt, Converter={StaticResource UtcToKst}}" />
            </ui:DataGrid.Columns>
        </ui:DataGrid>
       

        <uc:LoadingOverlay Grid.Row="0"
                           Grid.RowSpan="2"
                           Margin="-20"
                           IsOpen="{Binding ViewModel.IsBusy}"
                           Message="데이터를 불러오는 중..."
                           OverlayOpacity="0.28" />
    
        
    </Grid>
</Page>
 